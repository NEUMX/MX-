# 7、调优工具篇

# 7、调优工具篇
> + <font style="color:#000000;">怎么获取 Java 程序使用的内存？堆使用的百分比？（国美） </font>
>

> + <font style="color:#000000;"> 讲讲你理解的性能评价及测试指标？（瓜子） </font>
>

> + <font style="color:#000000;"> JVM的进程有哪些线程启动，有了解吗？（神州租车） </font>
>

> + <font style="color:#000000;"> 你使用过Java虚拟机性能监控和故障处理工具吗？（美图） </font>
>

> + <font style="color:#000000;"> 说说你知道的几种主要的JVM参数（京东） </font>
>

> + <font style="color:#000000;"> 怎么打出线程栈信息。（字节跳动） </font>
>

> + <font style="color:#000000;"> JVM的参数，你知道的说一下 (百度) </font>
>


## **<font style="color:#000000;">1. 怎么获取 Java 程序使用的内存？堆使用的百分比？（国美）</font>**
<font style="color:#000000;">获取Java程序使用内存和堆的使用百分比，可以通过JVM自带的命令行工具或者第三方工具实现：</font>

+ <font style="color:#000000;"> </font>**<font style="color:#000000;">通过JDK自带命令：</font>**<font style="color:#000000;"> </font>
    - <font style="color:#000000;"> 使用</font>`<font style="color:#000000;">jstat</font>`<font style="color:#000000;">命令可以查看堆内存使用情况： </font>

<font style="color:#000000;">其中</font>``<font style="color:#000000;">是Java进程ID，</font>`<font style="color:#000000;">间隔时间</font>`<font style="color:#000000;">是以毫秒为单位的时间间隔，</font>`<font style="color:#000000;">次数</font>`<font style="color:#000000;">是你希望收集多少次数据。该命令会输出各代内存区域的使用情况。 </font> - <font style="color:#000000;"> 使用</font>`<font style="color:#000000;">jmap</font>`<font style="color:#000000;">命令可以生成堆内存的详细快照： </font>jmap -heap  + **<font style="color:#000000;">通过JMX (Java Management Extensions)：</font>**<font style="color:#000000;">可以在运行时连接到JVM，并通过MBean接口获取内存信息。例如，通过JConsole、VisualVM等图形化工具，或编写代码直接访问MBean来获取内存使用情况。 </font> + **<font style="color:#000000;">通过编程方式：</font>**<font style="color:#000000;">在Java代码中，可以使用</font>`<font style="color:#000000;">java.lang.management</font>`<font style="color:#000000;">包下的</font>`<font style="color:#000000;">MemoryMXBean</font>`<font style="color:#000000;">和</font>`<font style="color:#000000;">MemoryUsage</font>`<font style="color:#000000;">类获取内存使用情况。 </font>**<font style="color:#000000;">2. 讲讲你理解的性能评价及测试指标？（瓜子）</font>**<font style="color:#000000;">性能评价及测试指标通常包括以下几方面：</font> + **<font style="color:#000000;">响应时间（Response Time）</font>**<font style="color:#000000;">：系统对请求作出响应所需的时间，如页面加载时间、API调用返回时间等。 </font> + **<font style="color:#000000;">吞吐量（Throughput）</font>**<font style="color:#000000;">：单位时间内系统处理请求的数量，比如每秒处理请求数（QPS）、每秒事务数（TPS）等。 </font> + **<font style="color:#000000;">并发用户数（Concurrency）</font>**<font style="color:#000000;">：系统能同时处理的用户请求数量，在压力测试中用来模拟高并发场景。 </font> + **<font style="color:#000000;">资源利用率（Resource Utilization）</font>**<font style="color:#000000;">：CPU、内存、磁盘、网络带宽等资源的使用情况。 </font> + **<font style="color:#000000;">稳定性（Stability）</font>**<font style="color:#000000;">：长时间运行下系统的稳定性和错误率，可以通过监控系统负载变化以及错误日志进行评估。 </font> + **<font style="color:#000000;">可扩展性（Scalability）</font>**<font style="color:#000000;">：随着负载增加，系统性能的变化趋势，理想情况下应保持线性增长。 </font> + **<font style="color:#000000;">内存效率（Memory Efficiency）</font>**<font style="color:#000000;">：包括内存占用、垃圾回收频率和停顿时间等。 </font> + **<font style="color:#000000;">数据库性能指标</font>**<font style="color:#000000;">：如SQL查询优化、索引利用效率、锁争抢情况等。 </font>**<font style="color:#000000;">3. JVM的进程有哪些线程启动，有了解吗？（神州租车）</font>**<font style="color:#000000;">JVM进程启动时会创建一系列线程，这些线程包括但不限于：</font> + **<font style="color:#000000;">GC线程</font>**<font style="color:#000000;">：用于执行垃圾回收操作，不同类型的垃圾回收器可能会有不同的GC线程实现。 </font> + **<font style="color:#000000;">主线程</font>**<font style="color:#000000;">：即执行main方法的线程。 </font> + **<font style="color:#000000;">后台编译线程</font>**<font style="color:#000000;">：HotSpot虚拟机中的C1（Client Compiler）和C2（Server Compiler）编译器对应的线程。 </font> + **<font style="color:#000000;">JIT（Just-In-Time）编译线程</font>**<font style="color:#000000;">：负责将热点代码从字节码转换为本地机器码。 </font> + **<font style="color:#000000;">信号检测处理线程</font>**<font style="color:#000000;">：用于处理操作系统发送给JVM的信号。 </font> + **<font style="color:#000000;">守护线程</font>**<font style="color:#000000;">：如Finalizer线程，负责调用对象finalize()方法；引用处理器线程，用于处理弱引用、软引用等清理工作。 </font> + **<font style="color:#000000;">线程调度相关的线程</font>**<font style="color:#000000;">：如中断检查线程、周期任务调度线程等。 </font>**<font style="color:#000000;">4. 你使用过Java虚拟机性能监控和故障处理工具吗？（美图）</font>**<font style="color:#000000;">常用的Java虚拟机性能监控和故障处理工具有：</font> + **<font style="color:#000000;">JConsole</font>**<font style="color:#000000;">：JDK自带的GUI监控工具，可以实时查看堆内存、线程、类加载等信息。 </font> + **<font style="color:#000000;">VisualVM</font>**<font style="color:#000000;">：功能更强大的综合性能分析工具，除了基本监控外，还支持内存分析、CPU采样分析、线程分析等。 </font> + **<font style="color:#000000;">JMC（Java Mission Control）</font>**<font style="color:#000000;">：Oracle提供的高级JVM性能监控和故障处理工具，包含Flight Recorder和Mission Control两个组件，提供详细的JVM诊断数据和分析能力。 </font> + **<font style="color:#000000;">MAT（Memory Analyzer Tool）</font>**<font style="color:#000000;">：专门针对内存泄漏问题进行分析的工具，可以生成并分析堆转储文件。 </font> + **<font style="color:#000000;">jstack</font>**<font style="color:#000000;">：用于打印Java进程的线程堆栈信息，便于排查死锁和线程阻塞等问题。 </font> + **<font style="color:#000000;">jmap</font>**<font style="color:#000000;">：用于生成堆dump文件，也可以查看堆内存的详细使用情况。 </font>**<font style="color:#000000;">5. 说说你知道的几种主要的JVM参数（京东）</font>**<font style="color:#000000;">一些常见的JVM参数包括：</font> + <font style="color:#000000;">堆内存设置：</font>`<font style="color:#000000;">-Xms</font>`<font style="color:#000000;">（初始堆大小）、</font>`<font style="color:#000000;">-Xmx</font>`<font style="color:#000000;">（最大堆大小）</font> + <font style="color:#000000;">新生代与老年代比例：</font>`<font style="color:#000000;">-XX:NewRatio</font>` + <font style="color:#000000;">GC相关选择：</font>`<font style="color:#000000;">-XX:+UseG1GC</font>`<font style="color:#000000;">、</font>`<font style="color:#000000;">-XX:+UseConcMarkSweepGC</font>`<font style="color:#000000;">、</font>`<font style="color:#000000;">-XX:+UseParallelGC</font>` + <font style="color:#000000;">线程栈大小：</font>`<font style="color:#000000;">-Xss</font>` + <font style="color:#000000;">年轻代分配策略：</font>`<font style="color:#000000;">-XX:SurvivorRatio</font>` + <font style="color:#000000;">Metaspace（元空间）大小设置：</font>`<font style="color:#000000;">-XX:MetaspaceSize</font>`<font style="color:#000000;">、</font>`<font style="color:#000000;">-XX:MaxMetaspaceSize</font>` + <font style="color:#000000;">垃圾回收日志：</font>`<font style="color:#000000;">-Xloggc:gc.log</font>`<font style="color:#000000;"> 或 </font>`<font style="color:#000000;">-XX:+PrintGCDetails</font>` + <font style="color:#000000;">JIT编译器选择：</font>`<font style="color:#000000;">-client</font>`<font style="color:#000000;"> 或 </font>`<font style="color:#000000;">-server</font>` + <font style="color:#000000;">监控与诊断：</font>`<font style="color:#000000;">-XX:+UnlockDiagnosticVMOptions</font>`<font style="color:#000000;"> 和 </font>`<font style="color:#000000;">-XX:StartFlightRecording</font>`<font style="color:#000000;"> 等</font>**<font style="color:#000000;">6. 怎么打出线程栈信息。（字节跳动）</font>**<font style="color:#000000;">使用</font>`<font style="color:#000000;">jstack</font>`<font style="color:#000000;">命令可以打印出Java进程的线程堆栈信息，命令格式如下：</font> jstack <font style="color:#000000;">其中 </font>`<font style="color:#000000;"><pid></font>`<font style="color:#000000;"> 是Java进程的ID。执行该命令后，将会在控制台打印出当前Java进程中所有线程的状态和堆栈跟踪信息，这对于分析死锁、线程阻塞等情况非常有用。</font> 更新: 2024-01-02 02:14:54 原文: [https://www.yuque.com/vip6688/neho4x/cqtukubs9rxh3okg](https://www.yuque.com/vip6688/neho4x/cqtukubs9rxh3okg)



> 更新: 2024-11-25 09:18:41  
> 原文: <https://www.yuque.com/neumx/laxg2e/94786234c871686d769aee7bebaa2aa2>